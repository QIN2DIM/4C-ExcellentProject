uuid,work_id,work_level,work_class,work_name,school,player,tutor,作品简介,开源代码与组件使用情况说明,作品安装说明,作品效果图,设计思路,设计重点和难点,指导老师自评,其他说明,部署链接1,部署链接2,插图
http://2020.jsjds.com.cn/chaxun/?keys=81941,81941,一等奖,软件应用与开发-移动应用开发(非游戏类),画中人——基于交互分割的人与景艺术风格融合APP,合肥工业大学,邬元航、赵煜、王熠桓,郝世杰、汪萌,我们这款APP基于交互式分割技术来完成对图片前景与背景的提取，用户可以在拍摄图片或者相册中选择图片后，在手机上通过触屏将需要保留的前景框选出来，程序将得到分割后的前景与背景。对于背景，我们将提供不同艺术化处理供用户自行选择，例如虚化，转换成水彩画风格，铅笔画风格等，对于前景不做改变，最终将二者按照分割的蒙版矩阵进行线性加和，即可实现对于前景和背景的风格融合，做到“虚实结和”，达到“人在画中游”的诗情画意之感。在处理之后，用户如果对处理的效果感到满意，还可以通过点击右下角的“保存”按钮对处理后的效果进行保存，也可在主界面中点击“分享”按钮对图片进行分享。,在算法方面使用了微软研究院所提出的grabCut图像分割算法以及基于L0平滑的卡通画算法，基于笔画结构与色调渲染的铅笔画算法。在系统层面使用了Google开源的Android Studio工具进行安卓端APP开发,"在百度云上下载安装包（链接: https://pan.baidu.com/s/12tcDQxH7s3EsDngRg69OGg 提取码: rq5e），点击安装（APP文件默认安装在Android/data/app/com.example.jason.IR-YFQNhjdZVuE-yQKXsQC7oQ==）。安装完成后根据提示，或在设置中将应用权限的存储权限和相机权限打开，即可完成安装操作。

安装流程如上图所示，在百度网盘下载后
1、点击安装包，系统跳出如上述第一张图的APP安装界面，点击“继续安装”。
2、软件显示“正在安装”，如第二张图片所示。
3、等待自动安装结束后跳出第三张安转完成的界面，可以点击“打开”按钮直接进入APP，或者点击“完成”，之后可在手机界面上相应位置点击图标打开APP。
4、打开APP后，如第四到六张图所示，点击“始终允许”按钮给予APP访问权限，之后可以正常使用。",,"1、整体算法流程
输入一张图片，我们利用交互式分割，得到分割蒙版，为保证后续融合时边界的平稳过渡，利用引导滤波进一步使我们的蒙版在边界处更加平滑。同时，将输入图片进行风格转化，计算图片的梯度和色彩通道，根据算法通过引导滤波得到最终结果。我们也提供多种融合方式作为融合加权矩阵，将原图与艺术化风格进行线性加和，得到最终的效果图。

算法整体路程图
2、分割算法
我们的分割算法采用微软所提出的GrabCut算法，对于输入的一张图片，我们可以有两种分割区域的选择，第一种是矩形框选择法，使用矩形框将所需要分割出的前景框选出来，算法会对我们的输入图像做一个初始化标记，将标记前景和背景像素并使用一个高斯混合模型（GMM），即多个单高斯模型，对前景和背景建模，GMM将根据框选的像素进行迭代优化，得到图片的分割蒙版，它将图片的像素分为四个等级，分别为背景；前景；可能是背景；可能是前景。之后只需利用蒙版就可以区分图片的前景与背景。第二种是蒙版法，对于矩形框选择法中处理效果不是很好的部分，可以利用第二种方法进行修补，手动画出前景或背景区域，直接对矩形框选择法处理后的蒙版进行修改，最终得到最佳的效果。

GrabCut算法流程图

GrabCut算法处理效果
3、图像风格转换
3.1、虚化功能
将原图通过高斯滤波，利用高斯卷积核对图片进行高斯模糊，可以得到虚化的效果。
虚化处理图
3.2、水彩画风格
首先计算每个像素的三通道值之和量化以后的值，以Q(x, y)表示。则该值的计算公式为
Q(x, y) = (R(x, y)+G(x, y)+B(x, y)) * Strength / 255
其中Strength表示平滑度，
我们再统计每个像素的邻域内的Q值的直方图Hist。
Hist(i) = card{(x, y)|Q(x, y) = i}
分别记录每个像素的邻域直方图Hist的统计对象所代表的像素的RGB。分以C(i)表示，其中i表示Hist的统计对象的值C，C是一个三元素的向量，三元素分别表示RGB的值。
C(i) = Rand{R(x, y), G(x, y), B(x, y)|Q(x, y) = i}
其中R(x, y), G(x, y), B(x, y)分别表示(x, y)位置处的RGB三分量的值。Rand表示从集合中随机选择一个元素，在实现时，简化为从集合中选择最后一个元素。
统计邻域直方图Hist最大的值所对应的RGB值，将该值赋给邻域中心点像素即可得到预期的效果图。
水彩画处理图
3.3、卡通画风格
我们采用L0平滑算法对图片进行迭代平滑，这是一种基于梯度的平滑方法，可以在保留较大的梯度同时去除较小的梯度。算法主要通过控制非零图像梯度的数目来增强图像显著边缘部分，以此达到图像的全局优化。
输入一张图片，分别计算水平方向和垂直方向的梯度，使用变量分裂法，松弛为两个二次规划问题，每个问题都将有其闭式解，即L0范数。

最小化，其中Sp是平滑后的图片在p处的像素值，就是图像水平和垂直方向的梯度， #{}表示计数，输出图像中满足的个数。
迭代优化时，先构造两个辅助变量hp,vp分别表示Sp的横向与纵向梯度，那么问题可以改写成

其中λ为正则化系数，β为平滑因子，则

由此计算，可以保证在梯度较大时保留边缘部分，在梯度较少时进行平滑操作。
最后我们对效果图进行canny边缘检测，将检测出的边缘部分重新加回效果图，以突出平滑后图片的轮廓，更具卡通画效果。
卡通画处理图
3.4、铅笔画风格
铅笔画主要由笔画结构(S)和色彩渲染(T)构成。
产生笔画结构时，首先对原图I进行多尺度滤波,生成粗糙到精致不同程度的子图，对各子图求梯度图G,与生成的8个方向的线段滤波器进行卷积, 由

可以得到8个方向对应的强度映射图Ci
再次利用8个线段滤波器对Ci进行,并求和进行归一化,最后求反,得到具有8个方向响应的线条形状图

色彩图产生时，将原始图像亮度值分为三个区域:明亮区、暗区和温和区。每个区域使用一种分布去描述该区域的亮度变化，依次为

对原始图像和预定的三个区域求累积分布,并通过直方图匹配得到色调图J，进行纹理渲染,记H为铅笔画风格图,使用H拟合.通过共轭梯度法法求和β

此时得到铅笔纹理图:
最后进行元素级求乘积，此时求得的结果对应灰度版的铅笔画,可做HSV->RGB的色彩空间逆变化,得到彩色版的铅笔画。
铅笔画处理图
3.5、虚拟背景
利用准二值融合蒙版可以完成对背景的替换，将选择好的虚拟背景根据原图大小进行双线性插值缩放，再与原图片进行线性加和即可。
虚拟背景处理图
4、风格融合
这里我们采用引导滤波来完善融合时边缘突兀的问题，将我们在grabCut分割中产生的蒙版作为引导图，对我们的原图进行滤波，所得的结果为最终的融合权值矩阵 ，利用融合矩阵，我们对前景与背景图片做线性加权，公式如下：

其中吗，F为前景，输入原图即可，B为背景，是我们经过风格变换后的图片，i为图片中的每一个像素点位置，I融合后的图片。

融合矩阵对比图
同时我们对于引导滤波的参数设置进行了大量的实验，实验结果大致分为三种情况，分别为融合权重比较弥散、近似为二值融合以及二值融合。我们这里选择二值融合以保证最终处理结果更好的达到“虚实结合”效果。
5、UI界面设计
针对本作品，采用了由谷歌的设计工程师基于传统优秀设计原则，结合丰富的创意和科学所发明的一套全新的界面设计语言材料设计语言（Material Design）来实现用户界面（User Interface）界面的美化。
APP界面
在UI布局时，本产中，灵活运用各种布局，以帧布局作为底层布局，以线性布局作为顶层布局，通过相对布局与百分比布局来灵活处理各种控件或布局之间的相对位置关系。
在本APP中，在Cardlayout.java活动中使用了材料设计语言的卡片式布局（Cardview），以及增添了刷新条（SeekBar）。
同时本作品新建了shape.xml 等自定义布局文件，定义了圆形的图形模型。同时新建item_photo,item_solve,item_more等xml文件，方面对同一种布局文件的重复使用，大大降低了代码的冗余度，以便于在活动布局中添加。达到了结合视觉，运动，互动效果等特性。
针对拍照功能，本产品没有直接调用手机所自带的拍照功能，而是通过自定义了一个继承于SurfaceView的拍照界面CameraPhotoView来进行拍照等一系列操作。在本布局文件中，我们可以自己设定摄像头的状态，拍照的方向，是否随重力感知，图片分辨率以及拍摄像功能的选择等问题。","创作重点主要是本作品的核心技术路线，即通过交互式分割方法区分照片中的人物与背景，并自动将原图转换为艺术化风格，再将真实的人物和艺术化的背景形成无缝融合，已达到“虚实结合”的效果。
 
创作难点主要有四点。
1、交互式分割处理需要需要给予用户良好的体验，保证既正确又快速的反馈用户所画分割区域。这里我们在Android Studio中自定义控件来完成对于用户所选分割区域的实时显示与刷新。
2、如果初次交互分割，因为分割误差较大，而影响最终效果，此时的解决方案是引入二次交互，允许用户在结果不满意的时候，还能确保最终效果的迭代优化。同时也减低了对于用户操作的要求度，用户在第一次选择时可以不需要过于精确。
3、对于交互式分割的结果存在一定的偏差，这将导致我们最终的风格融合结果显得突兀，对此我们采用引导滤波，以分割的蒙版为引导图，来对原图进行引导滤波，最终得到的蒙版将更好的完成分割任务。
4、由于我们的艺术画处理算法多使用迭代计算，在时效性上会有一定提高空间，如何把握权衡时效性和效果是一大难点，这里我们一般将图片转换成YUV空间，只对Y空间进行操作，UV空间不做处理，最终将处理后的图片再转回RGB色彩空间，可以减少一定的计算时间。同时，我们也对APP采用release签名编译模式，提高处理速度。因为在处理时照片越清晰，处理时时效性就会有所缺失。所以我们尽量优化算法，兼顾时效性和成像效果。",该参赛队成员通力协作，在安卓平台中实现并集成了交互式分割、风格转换以及无缝融合等多项图像处理技术，开发了一款交互式智能图像处理APP软件。该APP只需用户进行简单的交互式操作，就能实现“即拍即得，人在画中”的个性化肖像处理效果，这是目前各类主流移动图像处理软件所不具有的特色。,本次参赛，我们收获了很多很多，不仅包括相关知识的积累，相关技术的提升，还有导师的关心与帮助，在这里我们由衷的感谢我们的两位指导老师，感谢你们的无私奉献，感谢我的队友们，感谢你们的默默付出，感谢对我们的产品进行测试并提出改进意见的所有同学。,,,"['http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200613_162738.png', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200613_162833.png', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200614_062752.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200614_062844.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200614_062911.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200614_062933.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200614_063012.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200614_063101.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200614_063131.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200614_161349.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200614_161701.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200614_161748.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200614_164800.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200614_171631.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200614_171751.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200615_032247.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200615_032256.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200615_031915.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200615_031932.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200615_025931.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200615_031228.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200615_031355.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200615_031419.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200615_031629.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200615_031817.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200615_031749.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200615_025959.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200615_025803.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200615_025654.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200615_025532.jpg', 'http://2020.jsjds.com.cn/dasai/assets/uploadFiles/c0548384987de3a92d43317ab69bce9a/20200614_171445.jpg']"
